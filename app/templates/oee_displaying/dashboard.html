<link href="{{ url_for('static',filename='styles/style.css') }}" type="text/css" rel="stylesheet">

<div class="graph" id="graph">
    {{ graph|safe }}
</div>


{#<script>#}
{##}
{#    const updateInterval = setInterval(update, 5000);#}
{#    const graph = document.getElementsByClassName("plotly-graph-div")[0];#}
{##}
{#    function update() {#}
{#        //var data_update = {#}
{#//#}
{#        //};#}
{#//#}
{#        //var layout_update = {#}
{#        //    title: 'new title',#}
{#        //};#}
{##}
{#        const layout = graph.layout;#}
{#        console.log(layout);#}
{#        Plotly.relayout(graph, layout);#}
{##}
{#    }#}
{##}
{##}
{#    window.onresize = function () {#}
{#        // noinspection ES6ModulesDependencies (plotly.js is sent to template by flask)#}
{#        Plotly.relayout(graph, {#}
{#            width: 0.95 * window.innerWidth#}
{#        });#}
{##}
{#    };#}
{##}
{#</script>#}

<script src="{{ url_for('static', filename='javascript/jquery-3.3.1.min.js') }}"
        type="text/javascript"></script>
<script src="{{ url_for('static', filename='javascript/jquery-ui-1.12.1/jquery-ui.js') }}"
        type="text/javascript"></script>

<script type=text/javascript>
    $body = $("body");


    const updateInterval = setInterval(getLayout, 5000);
    //const graph = document.getElementsByClassName("plotly-graph-div")[0];
    window.onload = getLayout();


    function getLayout() {
        $graph = $(".plotly-graph-div");
        $body.addClass("loading");
        $.ajax({
            url: '{{ url_for('oee_displaying.dashboard') }}',
            method: "GET",
            data: {
                start: "{{ start }}",
                end:"{{ end }}",
                machine_group: 1,
                update: true //This tells the server not to send plotly.js again
            },
            success: function (response) {
                console.log("response = ", response);
                update(response);
            },
            error: function (error) {
                //console.log(error);
                //$('#graph').html("Error getting graph");
                //$body.removeClass("loading");
            }
        });
    }

    function update(response) {
        console.log(typeof graph, "old graph = ", graph);
        var elements = $(response);
        var newGraph = $(elements).find('.plotly-graph-div')[0];
        //console.log("new graph = ", newGraph);
        //var layout = newGraph.layout;
        //console.log("layout = ", layout);
        //Plotly.relayout(graph, layout);

        // Add the new graph to the page
        $graph.replaceWith(response);
    }

        {#TODO if it fails once it wont load again#}
</script>