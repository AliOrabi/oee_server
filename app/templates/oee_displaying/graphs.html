{% extends "default/base.html" %}
{% import "oee_displaying/form_templates.html" as form_templates %}

{% block content %}

    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/datepicker.css') }}">

    <div class="container mt-2">
        <label for="graphType">Graph type</label>

        <select id="graphType" class="form-control">
            {% for form in forms %}
                <option value="{{ form.__class__.__name__ }}">{{ form.graph_name }}</option>
            {% endfor %}
        </select>

        <div id="graphParametersForm">
            {#            Create all the forms and set to display:none. The dropdown makes them visible #}
            {% for form in forms %}
                <div id="{{ form.__class__.__name__ }}" class="disappearingGraphForm" style="display: none">
                    {{ form_templates.graph_form(form) }}
                </div>
            {% endfor %}
        </div>
    </div>

    <div class="container-fluid">
        <div class="main_graph" id="main_graph">
            {{ graph|safe }}
        </div>
    </div>
    </div>


    <script src="{{ url_for('static', filename='libraries/jquery-3.3.1.min.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='libraries/bootstrap-datepicker-master/js/bootstrap-datepicker.js') }}" type="text/javascript"></script>



    {#    <script src="{{ url_for('static', filename='libraries/jquery-3.3.1.min.js') }}" type="text/javascript"></script>#}
    {#    <script src="{{ url_for('static', filename='libraries/jquery-ui-1.12.1/jquery-ui.js') }}" type="text/javascript"></script>#}
    {##}
    {#    <script>#}
    {#Add the datepicker to the date inputs#}
    {#        //todo do this for every date, every time the form reloads#}
    {#        $(function () {#}
    {#            var today = new Date();#}
    {#            var yesterday = new Date();#}
    {#            yesterday.setDate(today.getDate() - 1);#}
    {#            var tomorrow = new Date();#}
    {#            tomorrow.setDate(today.getDate() + 1);#}
    {##}
    {#            $(".start_date").datepicker({dateFormat: 'dd-mm-yy'}).datepicker('setDate', today);#}
    {#            $(".end_date").datepicker({dateFormat: 'dd-mm-yy'}).datepicker('setDate', tomorrow);#}
    {##}
    {#        });#}
    {#    </script>#}


    <script type="application/javascript">
        {#    Add the datepicker to all forms with class "form-datepicker" #}
        $(document).ready(function () {
            var date_inputs = $(".form-datepicker");
            var options = {
                format: 'dd/mm/yyyy',
                todayHighlight: true,
                autoclose: true,
            };
            date_inputs.datepicker(options);
        });
    </script>



    {#    <link href="{{ url_for('static', filename='styles/datepicker.css') }}" type="text/css" rel="stylesheet">#}
    {#    <script>#}
    {#        $(document).ready(function () {#}
    {#            var date_input = $('input[name="start_date"]');#}
    {#            var container = $('.bootstrap-iso form').length > 0 ? $('.bootstrap-iso form').parent() : "body";#}
    {#            var options = {#}
    {#                format: 'dd/mm/yyyy',#}
    {#                container: container,#}
    {#                todayHighlight: true,#}
    {#                autoclose: true,#}
    {#            };#}
    {#            date_input.datepicker(options);#}
    {#        })#}
    {#    </script>#}


    <script>
        {#    Reload the form when the dropdown is selected #}
        document.getElementById("graphType").onchange = reloadForm;

        function reloadForm() {
            try {
                var selectedId = $("#graphType :selected").val();
                var forms = document.getElementsByClassName("disappearingGraphForm");
                if (forms != null) {
                    for (i = 0; i < forms.length; i++) {
                        forms[i].style.display = "none"
                    }
                }
                document.getElementById(selectedId).style.display = "block";
            } catch (err) {
                console.log("Failed to set form")
            }
        }

        // Run when the page first loads
        window.onload = reloadForm;

    </script>



    {#    <script type="application/javascript">#}
    {#        /** Disable the dates when requesting a dashboard graph, so the graph is full screen*/#}
    {#        function handleCheck() {#}
    {#            document.getElementById("start_date").disabled = document.getElementById("dashboard").checked;#}
    {#            document.getElementById("end_date").disabled = document.getElementById("dashboard").checked;#}
    {#        }#}
    {##}
    {#        $(document).ready(function () {#}
    {#            handleCheck();#}
    {#            // Add onclick to the dashboard#}
    {#            document.getElementById("dashboard").onclick = handleCheck#}
    {#        });#}
    {#    </script>#}




{% endblock %}